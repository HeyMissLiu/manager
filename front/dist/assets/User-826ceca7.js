import{b as n,r as w,l as se,i as V,E as b,c as d,C as re,o as p,d as x,e as N,f as l,w as a,A as U,q as h,m as O,h as m,F as R,n as B,z as ue,t as ne}from"./index-d2e98233.js";const de={class:"user-manager"},ie={class:"query-form"},pe={class:"base-table"},me={class:"action"},ce={class:"dialog-footer"},ve={__name:"User",setup(fe){const C=n(),g=n(!1);n(!1),w({name:"",region:"",date1:"",date2:"",delivery:!1,type:[],resource:"",desc:""});const r=w({state:3}),$=n([]),z=n([]),v=n("add"),y=n("添加"),T=w({userName:[{required:!0,message:"请输入用户名称",trigger:"blur"}],userEmail:[{required:!0,message:"请输入用户邮箱",trigger:"blur"}],mobile:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号格式",trigger:"blur"}],deptId:[{required:!0,message:"请输入用户邮箱",trigger:"blur"}]}),L=n([]),F=n(),i=w({state:1}),M=n([]),A=w([{label:"用户ID",prop:"userId"},{label:"用户名称",prop:"userName"},{label:"用户邮箱",prop:"userEmail"},{label:"用户角色",prop:"role",formatter(o,e,s){return console.log("value",s),{0:"管理员",1:"普通用户"}[s]}},{label:"用户状态",prop:"state",formatter(o,e,s){return{1:"在职",2:"离职",3:"试用期"}[s]}},{label:"注册时间",prop:"createTime",formatter(o,e,s){return O.utc2beijing(s)}},{label:"最后登录时间",prop:"lastLoginTime",formatter(o,e,s){return O.utc2beijing(s)}}]),k=n({});se(()=>{_(),Q(),G()});const Q=()=>{V.getDeptList().then(o=>{z.value=o})},G=()=>{V.getRoleAllList().then(o=>{$.value=o})},_=()=>{const o={...k.value,...i};V.userList(o).then(e=>{const{list:s,page:u}=e;M.value=s,k.value=u,s.length===0&&b.error("暂无数据!")})},H=o=>{k.value.pageNum=o,_()};function J(o){v.value="edit",y.value=v.value==="add"?"增加":"编辑",g.value=!0,ue(()=>{Object.assign(r,o),r.userEmail=r.userEmail.replace(/@.+$/g,"")})}const K=()=>{_()},E=o=>{o.resetFields(),_()};function P(o){const e={userIds:[o]};V.userDelete(e).then(s=>{s.nModified>0&&(b.success("成功删除用户!"),_())})}function W(){if(L.value.length===0){b.error("请选择要删除的用户!");return}const o={userIds:L.value};V.userDelete(o).then(e=>{e.nModified>0?(b.success(`批量删除成功, 已成功删除${e.nModified}个用户!`),_()):b.error("批量删除失败!")})}function X(o){L.value=o.map(e=>e.userId)}function Y(){v.value="add",y.value=v.value==="add"?"增加":"编辑",g.value=!0}function S(o){E(o),g.value=!1}function Z(o){o.validate(e=>{if(e){const s={...ne(r),userEmail:r.userEmail+"@163.com"};s.action=v.value,V.userSubmit(s).then(u=>{if(u.userId)b.success(y.value+"用户成功!"),g.value=!1,E(o),_();else return b.error(y.value+"用户失败!"),!1})}else b.error("校验表单失败")})}return(o,e)=>{const s=d("el-input"),u=d("el-form-item"),c=d("el-option"),D=d("el-select"),f=d("el-button"),q=d("el-form"),j=d("el-table-column"),ee=d("el-table"),le=d("el-pagination"),te=d("el-cascader"),ae=d("el-dialog"),I=re("has");return p(),x("div",de,[N("div",ie,[l(q,{inline:"",model:i,ref_key:"formRef",ref:F},{default:a(()=>[l(u,{label:"用户ID",prop:"userId"},{default:a(()=>[l(s,{modelValue:i.userId,"onUpdate:modelValue":e[0]||(e[0]=t=>i.userId=t),placeholder:"请输入用户ID"},null,8,["modelValue"])]),_:1}),l(u,{label:"用户名称",prop:"userName"},{default:a(()=>[l(s,{modelValue:i.userName,"onUpdate:modelValue":e[1]||(e[1]=t=>i.userName=t),placeholder:"请输入用户名称"},null,8,["modelValue"])]),_:1}),l(u,{label:"用户状态",prop:"state"},{default:a(()=>[l(D,{modelValue:i.state,"onUpdate:modelValue":e[2]||(e[2]=t=>i.state=t)},{default:a(()=>[l(c,{value:0,label:"所有"}),l(c,{value:1,label:"在职"}),l(c,{value:2,label:"离职"}),l(c,{value:3,label:"试用期"})]),_:1},8,["modelValue"])]),_:1}),l(u,null,{default:a(()=>[l(f,{type:"primary",onClick:K},{default:a(()=>[m("查询")]),_:1}),l(f,{onClick:e[3]||(e[3]=t=>E(F.value))},{default:a(()=>[m("重置")]),_:1})]),_:1})]),_:1},8,["model"])]),N("div",pe,[N("div",me,[U((p(),h(f,{type:"primary",onClick:Y},{default:a(()=>[m("新增")]),_:1})),[[I,"user-create"]]),U((p(),h(f,{type:"danger",disabled:i.state===2,onClick:W},{default:a(()=>[m("批量删除")]),_:1},8,["disabled"])),[[I,"user-patch-delete"]])]),l(ee,{data:M.value,style:{width:"100%"},onSelectionChange:X},{default:a(()=>[l(j,{type:"selection",width:"55"}),(p(!0),x(R,null,B(A,t=>(p(),h(j,{key:t.prop,prop:t.prop,label:t.label,width:t.width,formatter:t.formatter},null,8,["prop","label","width","formatter"]))),128)),l(j,{fixed:"right",label:"操作",width:"140"},{default:a(t=>[U((p(),h(f,{size:"small",onClick:oe=>J(t.row)},{default:a(()=>[m("编辑")]),_:2},1032,["onClick"])),[[I,"user-edit"]]),U((p(),h(f,{disabled:t.row.state===2,type:"danger",onClick:oe=>P(t.row.userId),size:"small"},{default:a(()=>[m("删除")]),_:2},1032,["disabled","onClick"])),[[I,"user-delete"]])]),_:1})]),_:1},8,["data"]),l(le,{"hide-on-single-page":"",class:"pagination",small:"","page-size":k.value.pageSize,background:"",layout:"prev, pager, next",total:k.value.total||0,onCurrentChange:H},null,8,["page-size","total"])]),l(ae,{title:y.value+"用户",modelValue:g.value,"onUpdate:modelValue":e[13]||(e[13]=t=>g.value=t),"before-close":()=>{S(C.value)}},{footer:a(()=>[N("span",ce,[l(f,{onClick:e[11]||(e[11]=t=>S(C.value))},{default:a(()=>[m("取消")]),_:1}),l(f,{type:"primary",onClick:e[12]||(e[12]=t=>Z(C.value))},{default:a(()=>[m("确定")]),_:1})])]),default:a(()=>[l(q,{ref_key:"dialogForm",ref:C,model:r,"label-width":"100px",rules:T},{default:a(()=>[l(u,{label:"用户名",prop:"userName"},{default:a(()=>[l(s,{modelValue:r.userName,"onUpdate:modelValue":e[4]||(e[4]=t=>r.userName=t),disabled:v.value=="edit",placeholder:"请输入用户名称"},null,8,["modelValue","disabled"])]),_:1}),l(u,{label:"邮箱",prop:"userEmail"},{default:a(()=>[l(s,{modelValue:r.userEmail,"onUpdate:modelValue":e[5]||(e[5]=t=>r.userEmail=t),disabled:v.value=="edit",placeholder:"请输入用户邮箱"},{append:a(()=>[m("@163.com")]),_:1},8,["modelValue","disabled"])]),_:1}),l(u,{label:"手机号",prop:"mobile"},{default:a(()=>[l(s,{modelValue:r.mobile,"onUpdate:modelValue":e[6]||(e[6]=t=>r.mobile=t),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),l(u,{label:"岗位",prop:"job"},{default:a(()=>[l(s,{modelValue:r.job,"onUpdate:modelValue":e[7]||(e[7]=t=>r.job=t),placeholder:"请输入岗位"},null,8,["modelValue"])]),_:1}),l(u,{label:"状态",prop:"state"},{default:a(()=>[l(D,{modelValue:r.state,"onUpdate:modelValue":e[8]||(e[8]=t=>r.state=t)},{default:a(()=>[l(c,{value:1,label:"在职"}),l(c,{value:2,label:"离职"}),l(c,{value:3,label:"试用期"})]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"系统角色",prop:"roleList"},{default:a(()=>[l(D,{modelValue:r.roleList,"onUpdate:modelValue":e[9]||(e[9]=t=>r.roleList=t),placeholder:"请选择用户系统角色",multiple:"",style:{width:"100%"}},{default:a(()=>[(p(!0),x(R,null,B($.value,t=>(p(),h(c,{key:t._id,label:t.roleName,value:t._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"部门",prop:"deptId"},{default:a(()=>[l(te,{modelValue:r.deptId,"onUpdate:modelValue":e[10]||(e[10]=t=>r.deptId=t),placeholder:"请选择所属部门",options:z.value,props:{checkStrictly:!0,value:"_id",label:"deptName"},clearable:"",style:{width:"100%"}},null,8,["modelValue","options"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","before-close"])])}}};export{ve as default};
