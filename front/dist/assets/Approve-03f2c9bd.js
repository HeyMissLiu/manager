import{a as K,r as v,b as s,l as O,c as p,o as w,d as A,e as u,f as e,w as t,m as b,t as P,i as L,h as g,F as W,n as X,g as d,q as j,s as Y,x as m,E as Z,y as z}from"./index-d2e98233.js";const ee={class:"leave-manager"},le={class:"query-form"},ae={class:"base-table"},te={class:"dialog-footer"},se={__name:"Approve",setup(oe){const q=K().state.userInfo,y=v({remark:""}),C=s();s();let i=s({});const k=s(!1),B=v([{label:"单号",prop:"orderNo"},{label:"申请人",prop:"",formatter(l){return l.applyUser.userName}},{label:"休假时间",prop:"",width:280,formatter(l){return b.utc2beijing(l.startTime)+" 到 "+b.utc2beijing(l.endTime)}},{label:"休假时长",prop:"leaveTime"},{label:"休假类型",prop:"applyType",formatter(l,a,r){return{1:"事假",2:"调休",3:"年假"}[r]}},{label:"休假原因",prop:"reasons"},{label:"申请时间",prop:"createTime",width:180,formatter:(l,a,r)=>b.utc2beijing(r)},{label:"审批人",prop:"auditUsers"},{label:"当前审批人",prop:"curAuditUserName"},{label:"审批状态",prop:"applyState",formatter:(l,a,r)=>({1:"待审批",2:"审批中",3:"审批拒绝",4:"审批通过",5:"作废"})[r]}]),N=v({applyState:1}),$=v({applyType:1,startTime:"",endTime:"",leaveTime:"0天",reasons:""}),T=v({}),D={remark:[{required:!0,message:"请输入审核备注",trigger:"change"}]},c=s({total:0,pageNum:1,pageSize:10});s(""),s(""),s("add"),s("添加");const S=s([]);s([]);const _=async()=>{const l={...P(N),...c.value,type:"approve"};l.leaveName||delete l.leaveName;const{list:a,page:r}=await L.getLeaveList(l);S.value=a,c.value=r};O(()=>{_()});const E=()=>{_()},M=l=>{k.value=!1,V(l)},I=l=>{c.value.pageNum=l,_()},V=l=>{console.log(l),l.resetFields(),console.log($)},R=l=>{let a={...l};a.applyTypeName={1:"事假",2:"调休",3:"年假"}[a.applyType],a.time=b.utc2beijing(l.startTime)+" 到 "+b.utc2beijing(l.endTime),a.applyStateName={1:"待审批",2:"审批中",3:"审批拒绝",4:"审批通过",5:"作废"}[a.applyState],i.value=a,k.value=!0},x=(l,a)=>{l.validate(r=>{if(r){let h={action:a,remark:y.remark,_id:i.value._id};try{L.leaveApprove(h),M(l),Z.success("处理成功"),_(),z.commit("saveNoticeCount",z.state.noticeCount-1)}catch(n){console.log(n)}}})};return(l,a)=>{const r=p("el-option"),h=p("el-select"),n=p("el-form-item"),f=p("el-button"),U=p("el-form"),F=p("el-table-column"),Q=p("el-table"),G=p("el-pagination"),H=p("el-input"),J=p("el-dialog");return w(),A("div",ee,[u("div",le,[e(U,{inline:"",model:N,ref_key:"formRef",ref:C},{default:t(()=>[e(n,{label:"审批状态",prop:"applyState"},{default:t(()=>[e(h,{modelValue:N.applyState,"onUpdate:modelValue":a[0]||(a[0]=o=>N.applyState=o)},{default:t(()=>[e(r,{value:"",label:"全部"}),e(r,{value:1,label:"待审批"}),e(r,{value:2,label:"审批中"}),e(r,{value:3,label:"审批拒绝"}),e(r,{value:4,label:"审批通过"}),e(r,{value:5,label:"作废"})]),_:1},8,["modelValue"])]),_:1}),e(n,null,{default:t(()=>[e(f,{type:"primary",onClick:E},{default:t(()=>[g("查询")]),_:1}),e(f,{onClick:a[1]||(a[1]=o=>{V(C.value),_()})},{default:t(()=>[g("重置")]),_:1})]),_:1})]),_:1},8,["model"])]),u("div",ae,[e(Q,{data:S.value},{default:t(()=>[(w(!0),A(W,null,X(B,o=>(w(),j(F,{key:o.prop,prop:o.prop,label:o.label,width:o.width,formatter:o.formatter},null,8,["prop","label","width","formatter"]))),128)),e(F,{label:"操作",width:"150"},{default:t(o=>[o.row.curAuditUserName==d(q).userName&&[1,2].includes(o.row.applyState)?(w(),j(f,{key:0,size:"small",type:"danger",onClick:re=>R(o.row)},{default:t(()=>[g("审核")]),_:2},1032,["onClick"])):Y("",!0)]),_:1})]),_:1},8,["data"]),e(G,{"hide-on-single-page":"",class:"pagination",small:"","page-size":c.value.pageSize,background:"",layout:"prev, pager, next",total:c.value.total||0,onCurrentChange:I},null,8,["page-size","total"])]),e(J,{title:"审核",width:"50%",modelValue:k.value,"onUpdate:modelValue":a[5]||(a[5]=o=>k.value=o),"destroy-on-close":""},{footer:t(()=>[u("span",te,[e(f,{onClick:a[3]||(a[3]=o=>x(T,"pass"))},{default:t(()=>[g("审核通过")]),_:1}),e(f,{onClick:a[4]||(a[4]=o=>x(T,"refuse")),type:"primary"},{default:t(()=>[g("驳回")]),_:1})])]),default:t(()=>[e(U,{"label-width":"120px","label-suffix":":",ref:"dialogForm",model:y,rules:D},{default:t(()=>[e(n,{label:"申请人"},{default:t(()=>[u("div",null,m(d(i).applyUser.userName),1)]),_:1}),e(n,{label:"休假类型"},{default:t(()=>[u("div",null,m(d(i).applyTypeName),1)]),_:1}),e(n,{label:"休假时间"},{default:t(()=>[u("div",null,m(d(i).time),1)]),_:1}),e(n,{label:"休假时长"},{default:t(()=>[u("div",null,m(d(i).leaveTime),1)]),_:1}),e(n,{label:"休假原因"},{default:t(()=>[u("div",null,m(d(i).reasons),1)]),_:1}),e(n,{label:"审批状态"},{default:t(()=>[u("div",null,m(d(i).applyStateName),1)]),_:1}),e(n,{label:"审批人"},{default:t(()=>[u("div",null,m(d(i).curAuditUserName),1)]),_:1}),e(n,{label:"备注",prop:"remark"},{default:t(()=>[e(H,{type:"textarea",rows:3,placeholder:"请输入审核备注",modelValue:y.remark,"onUpdate:modelValue":a[2]||(a[2]=o=>y.remark=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}};export{se as default};
